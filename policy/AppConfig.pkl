@go.Package { name = "github.com/asimihsan/planning_engine/internal/config" }
module myorg.myteam.AppConfig

import "package://pkg.pkl-lang.org/pkl-go/pkl.golang@0.10.0#/go.pkl"

/* ---------- nested types ---------- */

class Policy {
  bundleURI:       String   = "file:///policy/rego/main.rego"
  refreshInterval: Duration = 30.s
}

class FactProviders {
  levelServerBaseURL: String   = "http://levelserver.internal:8080"
  cacheTTL:           Duration = 15.s
  maxStaleness:       Duration = 45.s
  providerTimeout:    Duration = 5.s
  maxPendingAllowed:  Int      = 500
}

class Audit {
  logTarget:       "stdout" | "dynamodb" = "stdout"
  dynamoTableName: String                = "DeploymentGateAuditLog"
}

class Prometheus {
  listenAddr: String = ":9100"
}

/* ---------- module properties ---------- */

/// The hostname of this application.
host: String

/// The port to listen on.
port: UInt16

/// Policy-specific settings
policy: Policy

factProviders: FactProviders
audit: Audit
prometheus: Prometheus
